(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[792],{1973:(e,t,r)=>{"use strict";r.d(t,{k:()=>s});var i=r(9592),a=r(3041);class s extends a._y{#e;#t;constructor(e,t,r){let a=Object.assign({},null!=r?r:{},{batchMaxCount:1});(0,i.MR)(e&&e.request,"invalid EIP-1193 provider","ethereum",e),super(t,a),this.#t=null,r&&r.providerInfo&&(this.#t=r.providerInfo),this.#e=async(t,r)=>{let i={method:t,params:r};this.emit("debug",{action:"sendEip1193Request",payload:i});try{let t=await e.request(i);return this.emit("debug",{action:"receiveEip1193Result",result:t}),t}catch(t){let e=Error(t.message);throw e.code=t.code,e.data=t.data,e.payload=i,this.emit("debug",{action:"receiveEip1193Error",error:e}),e}}}get providerInfo(){return this.#t}async send(e,t){return await this._start(),await super.send(e,t)}async _send(e){(0,i.MR)(!Array.isArray(e),"EIP-1193 does not support batch request","payload",e);try{let t=await this.#e(e.method,e.params||[]);return[{id:e.id,result:t}]}catch(t){return[{id:e.id,error:{code:t.code,data:t.data,message:t.message}}]}}getRpcError(e,t){switch((t=JSON.parse(JSON.stringify(t))).error.code||-1){case 4001:t.error.message=`ethers-user-denied: ${t.error.message}`;break;case 4200:t.error.message=`ethers-unsupported: ${t.error.message}`}return super.getRpcError(e,t)}async hasSigner(e){null==e&&(e=0);let t=await this.send("eth_accounts",[]);return"number"==typeof e?t.length>e:(e=e.toLowerCase(),0!==t.filter(t=>t.toLowerCase()===e).length)}async getSigner(e){if(null==e&&(e=0),!await this.hasSigner(e))try{await this.#e("eth_requestAccounts",[])}catch(t){let e=t.payload;throw this.getRpcError(e,{id:e.id,error:t})}return await super.getSigner(e)}static async discover(e){if(null==e&&(e={}),e.provider)return new s(e.provider);let t=e.window?e.window:"undefined"!=typeof window?window:null;if(null==t)return null;let r=e.anyProvider;if(r&&t.ethereum)return new s(t.ethereum);if(!("addEventListener"in t&&"dispatchEvent"in t&&"removeEventListener"in t))return null;let a=e.timeout?e.timeout:300;return 0===a?null:await new Promise((n,l)=>{let o=[],d=e=>{o.push(e.detail),r&&c()},c=()=>{if(clearTimeout(u),o.length){if(e&&e.filter){let t=e.filter(o.map(e=>Object.assign({},e.info)));if(null==t)n(null);else if(t instanceof s)n(t);else{let e=null;if(t.uuid&&(e=o.filter(e=>t.uuid===e.info.uuid)[0]),e){let{provider:t,info:r}=e;n(new s(t,void 0,{providerInfo:r}))}else l((0,i.xz)("filter returned unknown info","UNSUPPORTED_OPERATION",{value:t}))}}else{let{provider:e,info:t}=o[0];n(new s(e,void 0,{providerInfo:t}))}}else n(null);t.removeEventListener("eip6963:announceProvider",d)},u=setTimeout(()=>{c()},a);t.addEventListener("eip6963:announceProvider",d),t.dispatchEvent(new Event("eip6963:requestProvider"))})}}},5789:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var i=r(5155),a=r(2115),s=r(5062),n=r(6172),l=r(6874),o=r.n(l);function d(){let[e,t]=(0,a.useState)(null),[r,l]=(0,a.useState)({institutionName:"",previousCertificateName:"",previousCertificateYear:"",certificateName:"",certificateId:"",uri:"",newCertificateYear:"",merkleRoot:"",recipients:"",certificateTokenUpdateQuantity:""}),[d,c]=(0,a.useState)("idle"),[u,m]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[f,x]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{t(await (0,n.Vy)())})()},[]);let g=e=>{l({...r,[e.target.name]:e.target.value}),m(null)},b=()=>e?r.institutionName?r.previousCertificateName?!r.previousCertificateYear||isNaN(Number(r.previousCertificateYear))?(m("Valid previous certificate year is required"),!1):r.certificateName?r.certificateId?r.uri?!r.newCertificateYear||isNaN(Number(r.newCertificateYear))?(m("Valid new certificate year is required"),!1):r.merkleRoot&&/^0x[a-fA-F0-9]{64}$/.test(r.merkleRoot)?!(!r.certificateTokenUpdateQuantity||isNaN(Number(r.certificateTokenUpdateQuantity)))||(m("Valid certificate token quantity is required"),!1):(m("Invalid Merkle root (must be 32-byte hex string)"),!1):(m("URI is required"),!1):(m("Certificate ID is required"),!1):(m("New certificate name is required"),!1):(m("Previous certificate name is required"),!1):(m("Institution name is required"),!1):(m("Wallet not connected"),!1),w=async()=>{m(null),p(null),x(!0);let e=r.recipients.split(/[\s,]+/).map(e=>e.trim()).filter(e=>e&&s.PW(e));if(0===e.length){m("Please provide at least one valid Ethereum address."),x(!1);return}try{let t=await fetch("/api/merkle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresses:e,sortPairs:!0})}),i=await t.json();if(!t.ok||!(null==i?void 0:i.root))throw Error((null==i?void 0:i.error)||"Failed to generate Merkle root.");p(i.root),l({...r,merkleRoot:i.root});let a=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download="proofs-".concat(r.certificateId||"certificate",".json"),n.click(),URL.revokeObjectURL(s)}catch(e){m(e.message||"Failed to generate Merkle root.")}finally{x(!1)}},v=async t=>{if(t.preventDefault(),c("loading"),m(null),!b()){c("error");return}try{let t=await (0,n.C8)(),i=await t.updateCertificate(e,r.institutionName,r.previousCertificateName,r.certificateName,r.certificateId,r.uri,Number(r.previousCertificateYear),Number(r.newCertificateYear),r.merkleRoot,Number(r.certificateTokenUpdateQuantity));await i.wait(),c("success")}catch(e){console.error("Update certificate error:",e),m(e.reason||e.message||"Failed to update certificate"),c("error")}};return(0,i.jsx)("main",{className:"min-h-screen bg-gradient-to-b from-[#0b0f1a] to-black text-white",children:(0,i.jsxs)("div",{className:"mx-auto max-w-4xl px-6 py-12",children:[(0,i.jsxs)("header",{className:"mb-8 flex items-center justify-between",children:[(0,i.jsx)(o(),{href:"/",className:"text-xl font-semibold tracking-tight",children:"CERTHUB"}),(0,i.jsx)("div",{className:"text-sm",children:e?(0,i.jsxs)("span",{className:"rounded-md bg-emerald-500/10 px-3 py-1 text-emerald-300",children:["✅ Connected: ",e.slice(0,6),"…",e.slice(-4)]}):(0,i.jsx)("span",{className:"rounded-md bg-yellow-500/10 px-3 py-1 text-yellow-300",children:"⚠️ Please connect your wallet"})})]}),(0,i.jsxs)("section",{className:"mb-10",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold sm:text-4xl",children:"Update Certificate"}),(0,i.jsx)("p",{className:"mt-2 text-white/70",children:"Update certificate details on the Hyperion Testnet. Only verified institutions and admins can access this page."})]}),(0,i.jsxs)("form",{onSubmit:v,className:"rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"Institution Name *"}),(0,i.jsx)("input",{className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"institutionName",value:r.institutionName,onChange:g,placeholder:"e.g., Havard",required:!0})]}),(0,i.jsxs)("div",{className:"mb-6 rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Previous Certificate Details"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"Previous Certificate Name *"}),(0,i.jsx)("input",{className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"previousCertificateName",value:r.previousCertificateName,onChange:g,placeholder:"e.g., celo",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"Previous Certificate Year *"}),(0,i.jsx)("input",{type:"number",className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"previousCertificateYear",value:r.previousCertificateYear,onChange:g,placeholder:"e.g., 2027",required:!0})]})]})]}),(0,i.jsxs)("div",{className:"mb-6 rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Update Details"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"New Certificate Name *"}),(0,i.jsx)("input",{className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"certificateName",value:r.certificateName,onChange:g,placeholder:"e.g., New Celo",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"Certificate ID *"}),(0,i.jsx)("input",{className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"certificateId",value:r.certificateId,onChange:g,placeholder:"e.g., CEL23-UPD",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"URI *"}),(0,i.jsx)("input",{className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"uri",value:r.uri,onChange:g,placeholder:"e.g., ipfs://Qm...",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"New Certificate Year *"}),(0,i.jsx)("input",{type:"number",className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"newCertificateYear",value:r.newCertificateYear,onChange:g,placeholder:"e.g., 2028",required:!0})]}),(0,i.jsxs)("div",{className:"md:col-span-2",children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"Recipients (for new Merkle root, comma-separated)"}),(0,i.jsx)("textarea",{className:"w-full min-h-[100px] rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"recipients",value:r.recipients,onChange:g,placeholder:"0xabc..., 0xdef..."}),(0,i.jsx)("button",{type:"button",onClick:w,disabled:f||!r.recipients.trim(),className:"mt-2 rounded-lg border border-white/20 bg-white/10 px-4 py-2 text-sm text-white hover:bg-white/15 disabled:opacity-50",children:f?"Generating…":"Generate Merkle Root & Download Proofs"}),h&&(0,i.jsxs)("p",{className:"mt-2 text-xs text-emerald-400",children:["Generated Merkle Root: ",h]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"text-sm text-white/70",children:"Certificate Token Update Quantity *"}),(0,i.jsx)("input",{type:"number",className:"w-full rounded-lg border border-white/10 bg-white/5 px-3 py-2 outline-none focus:ring-2 focus:ring-cyan-400",name:"certificateTokenUpdateQuantity",value:r.certificateTokenUpdateQuantity,onChange:g,placeholder:"e.g., 100",required:!0})]})]})]}),u&&(0,i.jsx)("div",{className:"mt-4 rounded-lg border border-red-500/30 bg-red-500/10 p-3 text-sm text-red-300",children:u}),"success"===d&&(0,i.jsx)("div",{className:"mt-4 rounded-lg border border-emerald-500/30 bg-emerald-500/10 p-3 text-sm text-emerald-300",children:"Certificate updated successfully!"}),(0,i.jsxs)("div",{className:"mt-6 flex items-center gap-3",children:[(0,i.jsx)("button",{type:"submit",disabled:"loading"===d,className:"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-700 disabled:opacity-50",children:"loading"===d?"Updating…":"Update Certificate"}),(0,i.jsx)(o(),{href:"/",className:"text-white/70 hover:underline",children:"Back to Home"})]})]}),(0,i.jsxs)("div",{className:"mt-10 rounded-xl border border-white/10 bg-white/5 p-4",children:[(0,i.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"What happens next?"}),(0,i.jsxs)("ul",{className:"list-disc space-y-1 pl-5 text-sm text-white/70",children:[(0,i.jsxs)("li",{children:["An on-chain ",(0,i.jsx)("em",{children:"CertificateUpdated"})," event is emitted."]}),(0,i.jsx)("li",{children:"The certificate's details are updated in the contract."}),(0,i.jsx)("li",{children:"Recipients can continue to claim using the updated Merkle root."})]})]})]})})}},7469:(e,t,r)=>{Promise.resolve().then(r.bind(r,5789))}},e=>{var t=t=>e(e.s=t);e.O(0,[874,41,172,441,684,358],()=>t(7469)),_N_E=e.O()}]);